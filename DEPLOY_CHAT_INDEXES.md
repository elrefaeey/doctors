# ูุดุฑ Firestore Indexes ูููุญุงุฏุซุงุช

## ุงููุดููุฉ
ุนูุฏ ูุชุญ ุตูุญุฉ ุงููุญุงุฏุซุงุชุ ูุธูุฑ ุฎุทุฃ:
```
The query requires an index. You can create it here: [ุฑุงุจุท Firebase Console]
```

## ุงูุณุจุจ
Firestore ูุญุชุงุฌ ุฅูู Indexes (ููุงุฑุณ) ููุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ ุงูุชู ุชุณุชุฎุฏู ุฃูุซุฑ ูู ุญูู ูุงุญุฏ.

## ุงูุญู

### ุงูุทุฑููุฉ 1: ูุดุฑ ุงูู Indexes ุชููุงุฆูุงู (ุงูุฃุณุฑุน) โ

ูู ุจุชุดุบูู ุงูุฃูุฑ ุงูุชุงูู:

```bash
firebase deploy --only firestore:indexes
```

ูุฐุง ุงูุฃูุฑ ุณูููู ุจู:
1. ูุฑุงุกุฉ ููู `firestore.indexes.json`
2. ุฅูุดุงุก ุฌููุน ุงูู Indexes ุงููุทููุจุฉ ุนูู Firebase
3. ุงูุงูุชุธุงุฑ ุญุชู ูุชู ุจูุงุก ุงูู Indexes (ูุฏ ูุณุชุบุฑู ุจุถุน ุฏูุงุฆู)

### ุงูุทุฑููุฉ 2: ุฅูุดุงุก Index ูุฏููุงู ูู Firebase Console

1. ุงูุชุญ ุงูุฑุงุจุท ุงูุฐู ูุธูุฑ ูู ุฑุณุงูุฉ ุงูุฎุทุฃ
2. ุณููุชุญ Firebase Console ูุจุงุดุฑุฉ ุนูู ุตูุญุฉ ุฅูุดุงุก Index
3. ุงุถุบุท "Create Index"
4. ุงูุชุธุฑ ุญุชู ูุชู ุจูุงุก ุงูู Index (ูุฏ ูุณุชุบุฑู ุจุถุน ุฏูุงุฆู)

---

## ุงูู Indexes ุงููุทููุจุฉ

### Index 1: ููุฃุทุจุงุก (doctorId + lastMessageTime)
```json
{
  "collectionGroup": "chats",
  "queryScope": "COLLECTION",
  "fields": [
    {
      "fieldPath": "doctorId",
      "order": "ASCENDING"
    },
    {
      "fieldPath": "lastMessageTime",
      "order": "DESCENDING"
    }
  ]
}
```

### Index 2: ูููุฑุถู (patientId + lastMessageTime)
```json
{
  "collectionGroup": "chats",
  "queryScope": "COLLECTION",
  "fields": [
    {
      "fieldPath": "patientId",
      "order": "ASCENDING"
    },
    {
      "fieldPath": "lastMessageTime",
      "order": "DESCENDING"
    }
  ]
}
```

---

## ููุงุฐุง ูุญุชุงุฌ ูุฐู ุงูู Indexesุ

### ููุฃุทุจุงุก:
ุนูุฏูุง ููุชุญ ุงูุทุจูุจ ุตูุญุฉ ุงููุญุงุฏุซุงุชุ ุงููุธุงู ูุจุญุซ ุนู:
- ุฌููุน ุงููุญุงุฏุซุงุช ุงูุชู `doctorId` = ูุนุฑู ุงูุทุจูุจ
- ูุฑุชุจุฉ ุญุณุจ `lastMessageTime` ูู ุงูุฃุญุฏุซ ููุฃูุฏู

### ูููุฑุถู:
ุนูุฏูุง ููุชุญ ุงููุฑูุถ ุตูุญุฉ ุงููุญุงุฏุซุงุชุ ุงููุธุงู ูุจุญุซ ุนู:
- ุฌููุน ุงููุญุงุฏุซุงุช ุงูุชู `patientId` = ูุนุฑู ุงููุฑูุถ
- ูุฑุชุจุฉ ุญุณุจ `lastMessageTime` ูู ุงูุฃุญุฏุซ ููุฃูุฏู

---

## ุงูุชุญูู ูู ูุฌุงุญ ุงููุดุฑ

### ูู Terminal:
ุจุนุฏ ุชุดุบูู ุงูุฃูุฑุ ุณุชุธูุฑ ุฑุณุงูุฉ:
```
โ  Deploy complete!
```

### ูู Firebase Console:
1. ุงุฐูุจ ุฅูู Firebase Console
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงุฐูุจ ุฅูู Firestore Database
4. ุงุถุบุท ุนูู ุชุจููุจ "Indexes"
5. ูุฌุจ ุฃู ุชุฑู ุงูู Indexes ุงูุฌุฏูุฏุฉ ุจุญุงูุฉ "Building" ุฃู "Enabled"

### ูู ุงูุชุทุจูู:
1. ุงูุชุญ ุงูุชุทุจูู
2. ุณุฌู ุฏุฎูู ููุฑูุถ ุฃู ุทุจูุจ
3. ุงุฐูุจ ูุตูุญุฉ ุงููุญุงุฏุซุงุช
4. ูุฌุจ ุฃู ุชุนูู ุจุฏูู ุฃุฎุทุงุก

---

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **ููุช ุงูุจูุงุก**: ูุฏ ูุณุชุบุฑู ุจูุงุก ุงูู Index ูู 5-15 ุฏูููุฉ ุญุณุจ ุญุฌู ุงูุจูุงูุงุช
โ๏ธ **ุงูุงุณุชุนูุงูุงุช ุงููุฏููุฉ**: ุญุชู ูุชู ุจูุงุก ุงูู Indexุ ูู ุชุนูู ุงูุงุณุชุนูุงูุงุช
โ **ูุฑุฉ ูุงุญุฏุฉ ููุท**: ุชุญุชุงุฌ ููุดุฑ ุงูู Indexes ูุฑุฉ ูุงุญุฏุฉ ููุท
โ **ุชููุงุฆู**: ุจุนุฏ ุงููุดุฑุ ุณูุนูู ูู ุดูุก ุชููุงุฆูุงู

---

## ุงูุฃูุงูุฑ ุงููููุฏุฉ

### ูุดุฑ ุงูู Indexes ููุท:
```bash
firebase deploy --only firestore:indexes
```

### ูุดุฑ ูู ุดูุก (Indexes + Rules):
```bash
firebase deploy --only firestore
```

### ุนุฑุถ ุงูู Indexes ุงูุญุงููุฉ:
```bash
firebase firestore:indexes
```

---

## ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ

1. ุชุฃูุฏ ูู ุฃูู ูู ุงููุฌูุฏ ุงูุตุญูุญ ูููุดุฑูุน
2. ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู ูู Firebase:
   ```bash
   firebase login
   ```
3. ุชุฃูุฏ ูู ุงุฎุชูุงุฑ ุงููุดุฑูุน ุงูุตุญูุญ:
   ```bash
   firebase use doctor-20c9d
   ```
4. ุฌุฑุจ ุงููุดุฑ ูุฑุฉ ุฃุฎุฑู:
   ```bash
   firebase deploy --only firestore:indexes
   ```

---

## ุงูุฎูุงุตุฉ

โ ูู ุจุชุดุบูู: `firebase deploy --only firestore:indexes`
โ ุงูุชุธุฑ 5-15 ุฏูููุฉ ุญุชู ูุชู ุจูุงุก ุงูู Indexes
โ ุงูุชุญ ุงูุชุทุจูู ูุฌุฑุจ ุตูุญุฉ ุงููุญุงุฏุซุงุช
โ ูุฌุจ ุฃู ุชุนูู ุจุฏูู ุฃุฎุทุงุก ุงูุขู!

๐ ุจุนุฏ ุงููุดุฑุ ุณุชุนูู ุงููุญุงุฏุซุงุช ุจุณูุงุณุฉ!
