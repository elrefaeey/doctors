# نظام طلبات انضمام الأطباء

## نظرة عامة
نظام يسمح للأطباء بتقديم طلبات انضمام يتم مراجعتها والموافقة عليها من قبل الإدارة قبل إنشاء الحسابات.

## المميزات الرئيسية

### 1. نموذج طلب الانضمام للأطباء

**الحقول المطلوبة:**
- الاسم الكامل ✓
- التخصص (قائمة منسدلة) ✓
- رقم الهاتف ✓
- المحافظة ✓

**الحقول الاختيارية:**
- نبذة مختصرة
- سعر الكشف
- العنوان التفصيلي
- معلومات إضافية

**كيفية الوصول:**
1. صفحة تسجيل دخول الطبيب
2. زر "املأ بياناتك للانضمام"
3. ملء النموذج
4. إرسال الطلب
5. رسالة تأكيد: "طلبك قيد المراجعة من قبل الإدارة"

### 2. لوحة تحكم الإدارة - صفحة طلبات الأطباء

**المميزات:**
- عرض جميع الطلبات
- تصفية حسب الحالة (الكل / قيد المراجعة / موافق عليها / مرفوضة)
- عرض تفاصيل كل طلب
- الموافقة أو الرفض

**عند الموافقة على الطلب:**

النظام يقوم تلقائياً بـ:
1. إنشاء بريد إلكتروني: `اسم_الطبيب@doctor.com`
2. إنشاء كلمة مرور عشوائية آمنة (10 أحرف)
3. إنشاء حساب Firebase Authentication
4. إنشاء ملف المستخدم في قاعدة البيانات
5. إنشاء ملف الطبيب في قاعدة البيانات
6. تحديث حالة الطلب إلى "موافق عليه"
7. حفظ بيانات الدخول في الإشعارات

**مثال على البريد الإلكتروني المُنشأ:**
- "أحمد علي" → `ahmedali@doctor.com`
- "محمد حسن" → `mohamedhassan@doctor.com`

**مثال على كلمة المرور:**
- `Ab7xP92k3Q`
- `Xy4mN81pL9`

### 3. تغيير كلمة المرور للأطباء

**الموقع:**
لوحة تحكم الطبيب → الملف الشخصي → قسم الأمان

**المتطلبات:**
- كلمة المرور الحالية
- كلمة المرور الجديدة (8 أحرف على الأقل)
- تأكيد كلمة المرور الجديدة

**الأمان:**
- يتطلب إعادة المصادقة قبل التغيير
- كلمات المرور لا تُحفظ في قاعدة البيانات
- فقط Firebase Authentication يحفظ كلمات المرور المشفرة

## البيانات المُنشأة

### مجموعة users
```javascript
{
  uid: "معرف_فريد",
  email: "ahmedali@doctor.com",
  displayName: "أحمد علي",
  name: "أحمد علي",
  role: "doctor",
  createdAt: "تاريخ_الإنشاء",
  language: "ar"
}
```

### مجموعة doctors
```javascript
{
  id: "معرف_فريد",
  email: "ahmedali@doctor.com",
  displayName: "أحمد علي",
  specialization: "أمراض القلب",
  bio: "نبذة مختصرة",
  phone: "01xxxxxxxxx",
  consultationPrice: 200,
  governorate: "القاهرة",
  address: "العنوان التفصيلي",
  additionalInfo: "معلومات إضافية",
  subscriptionType: "silver",
  verificationStatus: "verified",
  rating: 0,
  totalReviews: 0,
  totalPatients: 0,
  experience: 0
}
```

### مجموعة doctorRequests
```javascript
{
  name: "أحمد علي",
  specialization: "cardiology",
  phone: "01xxxxxxxxx",
  governorate: "القاهرة",
  status: "pending", // أو "approved" أو "rejected"
  createdAt: "تاريخ_الطلب",
  // بعد الموافقة:
  doctorId: "معرف_الطبيب",
  generatedEmail: "ahmedali@doctor.com",
  approvedAt: "تاريخ_الموافقة"
}
```

## قواعد الأمان (Firestore Rules)

```javascript
// طلبات الأطباء - أي شخص يمكنه التقديم، فقط الإدارة يمكنها القراءة/التعديل
match /doctorRequests/{requestId} {
  allow read: if isAdmin();
  allow create: if true;
  allow update: if isAdmin();
  allow delete: if isAdmin();
}
```

## خطوات النشر

### نشر قواعد Firestore:
```bash
firebase deploy --only firestore:rules
```

### نشر التطبيق كاملاً:
```bash
npm run build
firebase deploy
```

## قائمة الاختبار

### تدفق الطبيب:
- [ ] الطبيب يمكنه الوصول لنموذج الطلب
- [ ] جميع الحقول المطلوبة تعمل
- [ ] التخصصات تُحمّل من قاعدة البيانات
- [ ] قائمة المحافظات تعمل
- [ ] فحص رقم الهاتف المكرر يعمل
- [ ] رسالة النجاح تظهر بعد الإرسال
- [ ] الطلب يظهر في لوحة تحكم الإدارة

### تدفق الإدارة:
- [ ] الإدارة يمكنها عرض جميع الطلبات
- [ ] التصفية حسب الحالة تعمل
- [ ] تفاصيل الطلب تظهر بشكل صحيح
- [ ] الموافقة تُنشئ الحساب بنجاح
- [ ] بيانات الدخول تُحفظ في الإشعارات
- [ ] الرفض يُحدّث الحالة بشكل صحيح

### تغيير كلمة المرور:
- [ ] نافذة تغيير كلمة المرور تفتح
- [ ] التحقق من كلمة المرور الحالية يعمل
- [ ] التحقق من طول كلمة المرور الجديدة يعمل
- [ ] مطابقة تأكيد كلمة المرور تعمل
- [ ] إعادة المصادقة تعمل بشكل صحيح
- [ ] تحديث كلمة المرور ينجح
- [ ] رسالة النجاح تظهر
- [ ] الطبيب يمكنه تسجيل الدخول بكلمة المرور الجديدة

## التحسينات المستقبلية

1. **إرسال البريد الإلكتروني/الرسائل النصية:**
   - إرسال بيانات الدخول للطبيب بعد الموافقة
   - استخدام Firebase Cloud Functions + SendGrid/Twilio

2. **إدارة بيانات الدخول:**
   - واجهة للإدارة لعرض بيانات الدخول المُنشأة
   - إعادة إرسال بيانات الدخول
   - إعادة تعيين كلمة المرور للأطباء

3. **إدارة الطلبات:**
   - تعديل الطلب قبل الموافقة
   - طلب معلومات إضافية من الطبيب
   - الموافقة/الرفض الجماعي

4. **التحليلات:**
   - تتبع معدلات الموافقة على الطلبات
   - مراقبة وقت معالجة الطلبات
   - مقاييس انضمام الأطباء

## ملاحظات مهمة

- بيانات الدخول حالياً تُحفظ في الإشعارات للرجوع إليها
- في الإنتاج، يجب تطبيق إرسال البريد الإلكتروني/الرسائل النصية
- يُنصح بإضافة خطوة التحقق من البريد الإلكتروني
- مراقبة حالات تكرار البريد الإلكتروني المُنشأ
- تطبيق حد لمعدل تقديم الطلبات

## المحافظات المصرية المدعومة

القاهرة، الجيزة، الإسكندرية، الدقهلية، البحيرة، الفيوم، الغربية، الإسماعيلية، المنوفية، المنيا، القليوبية، الوادي الجديد، الشرقية، أسيوط، سوهاج، قنا، أسوان، الأقصر، البحر الأحمر، كفر الشيخ، مطروح، شمال سيناء، جنوب سيناء، بورسعيد، دمياط، السويس
