# ูุธุงู ุงููุญุงุฏุซุงุช ุงูุฌุฏูุฏ - Chat System 2.0

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ูุญุงุฏุซุงุช ุฌุฏูุฏ ูููุงู ูุชุจุน ุฃูุถู ุงูููุงุฑุณุงุช ูู ุชุทุจููุงุช ุงูุฑุนุงูุฉ ุงูุตุญูุฉ ูุน ุชุตููู ูุธูู ูุญุฏูุซ.

## ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ โจ

### 1. ูุธุงู ุทูุจุงุช ุงููุญุงุฏุซุฉ
- โ ุงููุฑูุถ ูุฑุณู ุฑุณุงูุฉ ูุงุญุฏุฉ ุฃูููุฉ ููุท
- โ ุงูุฏูุชูุฑ ููุจู ุฃู ูุฑูุถ ุงูุทูุจ
- โ ุฅุฐุง ูุจู: ุชูุชุญ ูุญุงุฏุซุฉ ูุงููุฉ ุจูู ุงูุทุฑููู
- โ ุฅุฐุง ุฑูุถ: ุงููุฑูุถ ูุง ูุณุชุทูุน ุฅุฑุณุงู ุฑุณุงุฆู ุฃุฎุฑู + ุญุฐู ุงููุญุงุฏุซุฉ ูู ููุญุฉ ุงูุฏูุชูุฑ

### 2. ุญุงูุงุช ุงููุญุงุฏุซุฉ (Status)
- **Pending** (ููุฏ ุงูุงูุชุธุงุฑ): ุงูุฑุณุงูุฉ ุงูุฃูููุฉ ูู ุงูุชุธุงุฑ ุฑุฏ ุงูุฏูุชูุฑ
- **Accepted** (ููุจูู): ุงูุฏูุชูุฑ ูุจู ุงููุญุงุฏุซุฉ - ูููู ุชุจุงุฏู ุงูุฑุณุงุฆู ุจุญุฑูุฉ
- **Rejected** (ูุฑููุถ): ุงูุฏูุชูุฑ ุฑูุถ ุงููุญุงุฏุซุฉ - ูุง ูููู ุฅุฑุณุงู ุฑุณุงุฆู

### 3. ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช
- โ ุงููุณุชุฎุฏููู ูููููู ุญุฐู ุงููุญุงุฏุซุงุช ูู ููุญุงุชูู
- โ ุงูุฑุณุงุฆู ุงููุฑุฏูุฉ ูุง ูููู ุญุฐููุง (ููุญูุงุธ ุนูู ุงูุณุฌู ุงูุทุจู)
- โ ุงููุญุงุฏุซุงุช ุงููุฑููุถุฉ ุชุฎุชูู ุชููุงุฆูุงู ูู ููุญุฉ ุงูุฏูุชูุฑ
- โ ุงููุญุงุฏุซุงุช ุงููุญุฐููุฉ ุชุฎุชูู ูู ูุงุฆูุฉ ุงููุณุชุฎุฏู ููุท

### 4. ูุคุดุฑุงุช ุงููุฑุงุกุฉ (Read Receipts)
- โ ุนูุงูุฉ ูุงุญุฏุฉ (โ): ุงูุฑุณุงูุฉ ุชู ุฅุฑุณุงููุง
- โ ุนูุงูุชุงู (โโ): ุงูุฑุณุงูุฉ ุชู ูุฑุงุกุชูุง
- โ ุนุฏุงุฏ ุงูุฑุณุงุฆู ุบูุฑ ุงูููุฑูุกุฉ ููู ูุญุงุฏุซุฉ

### 5. ุงูุชุตููู
- ๐จ ุชุตููู ูุธูู ูุญุฏูุซ (Clean & Modern)
- ๐จ ุฃููุงู ูุงุฏุฆุฉ (ุฃุฒุฑู/ุฃุจูุถ)
- ๐จ ููุงุนุงุช ูุญุงุฏุซุฉ ูุณุชุฏูุฑุฉ (Rounded Bubbles)
- ๐จ ุธูุงู ุฎูููุฉ (Subtle Shadows)
- ๐จ ูุตูุต ููุท (Text-Only) - ุจุฏูู ุตูุฑ ุฃู ููุฏูู ุฃู ุตูุช
- ๐ฑ ูุชุฌุงูุจ (Responsive) - ูุนูู ุนูู ุงูููุจุงูู ูุงูุฏูุณูุชูุจ

## ุงูุจููุฉ ุงูุชูููุฉ

### ุงููููุงุช ุงููุนุฏูุฉ/ุงูุฌุฏูุฏุฉ

#### 1. `src/services/chatService.ts`
**ุงููุธุงุฆู ุงูุฌุฏูุฏุฉ:**
- `createChatRequest()` - ุฅูุดุงุก ุทูุจ ูุญุงุฏุซุฉ ุฌุฏูุฏ
- `acceptChatRequest()` - ูุจูู ุทูุจ ุงููุญุงุฏุซุฉ (ุฏูุชูุฑ ููุท)
- `rejectChatRequest()` - ุฑูุถ ุทูุจ ุงููุญุงุฏุซุฉ (ุฏูุชูุฑ ููุท)
- `deleteChatConversation()` - ุญุฐู ุงููุญุงุฏุซุฉ ูู ูุงุฆูุฉ ุงููุณุชุฎุฏู
- `getUserChats()` - ุฌูุจ ูุญุงุฏุซุงุช ุงููุณุชุฎุฏู (ูุน ููุชุฑุฉ)
- `sendMessage()` - ุฅุฑุณุงู ุฑุณุงูุฉ (ููุท ูู ุงููุญุงุฏุซุงุช ุงูููุจููุฉ)
- `listenToMessages()` - ุงูุงุณุชูุงุน ููุฑุณุงุฆู ุงูุฌุฏูุฏุฉ
- `markMessagesAsRead()` - ุชุนููู ุงูุฑุณุงุฆู ูููุฑูุกุฉ

#### 2. `src/types/firebase.ts`
**ุชุญุฏูุซ Chat Interface:**
```typescript
export interface Chat {
    id: string;
    doctorId: string;
    patientId: string;
    doctorName: string;
    patientName: string;
    status: 'pending' | 'accepted' | 'rejected';
    initialMessage: string;
    lastMessage: string;
    lastMessageTime: any;
    unreadCount: {
        doctor: number;
        patient: number;
    };
    deletedBy?: {
        doctor?: boolean;
        patient?: boolean;
    };
    createdAt: any;
    updatedAt: any;
}
```

#### 3. `src/components/ChatList.tsx`
**ุงููููุฒุงุช:**
- ุนุฑุถ ูุงุฆูุฉ ุงููุญุงุฏุซุงุช ูุน ุงูุญุงูุงุช
- ุฃุฒุฑุงุฑ ูุจูู/ุฑูุถ ููุฏูุชูุฑ (ููุทูุจุงุช ุงููุนููุฉ)
- ุฒุฑ ุญุฐู ุงููุญุงุฏุซุฉ
- ุนุฏุงุฏ ุงูุฑุณุงุฆู ุบูุฑ ุงูููุฑูุกุฉ
- badges ููุญุงูุงุช (Pending/Accepted/Rejected)

#### 4. `src/components/ChatWindow.tsx`
**ุงููููุฒุงุช:**
- ุนุฑุถ ุงูุฑุณุงุฆู ูุน ููุงุนุงุช ููููุฉ
- ูุคุดุฑุงุช ุงููุฑุงุกุฉ (โ ู โโ)
- ุชุฌููุน ุงูุฑุณุงุฆู ุญุณุจ ุงูุชุงุฑูุฎ
- ููุน ุฅุฑุณุงู ุฑุณุงุฆู ูู ุงููุญุงุฏุซุงุช ุบูุฑ ุงูููุจููุฉ
- ุชุตููู ูุธูู ูุน ุฃููุงู ูุงุฏุฆุฉ

#### 5. `src/pages/DoctorProfile.tsx`
**ุงูุชุญุฏูุซุงุช:**
- ุฒุฑ "ุฅุฑุณุงู ุฑุณุงูุฉ" ุจุฏูุงู ูู "ูุญุงุฏุซุฉ ุงูุทุจูุจ"
- ููุฏุงู ููุชุงุจุฉ ุงูุฑุณุงูุฉ ุงูุฃูููุฉ
- ุงูุชุญูู ูู ุญุงูุฉ ุงููุญุงุฏุซุฉ ูุจู ุงูุฅุฑุณุงู

## ุณูุฑ ุงูุนูู (Workflow)

### ูููุฑูุถ:

1. **ุฅุฑุณุงู ุฑุณุงูุฉ ุฃูููุฉ:**
   - ุงููุฑูุถ ููุชุญ ุตูุญุฉ ุงูุฏูุชูุฑ
   - ูุถุบุท ุนูู "ุฅุฑุณุงู ุฑุณุงูุฉ"
   - ููุชุจ ุฑุณุงูุชู ุงูุฃูููุฉ
   - ูุฑุณู ุงูุทูุจ

2. **ุงูุชุธุงุฑ ุงูุฑุฏ:**
   - ุงูุฑุณุงูุฉ ุชุธูุฑ ูู ููุญุฉ ุงููุฑูุถ ุจุญุงูุฉ "ููุฏ ุงูุงูุชุธุงุฑ"
   - ูุง ูููู ุฅุฑุณุงู ุฑุณุงุฆู ุฅุถุงููุฉ ุญุชู ููุจู ุงูุฏูุชูุฑ

3. **ุจุนุฏ ุงููุจูู:**
   - ุงููุญุงุฏุซุฉ ุชุตุจุญ "ููุจูู"
   - ูููู ุชุจุงุฏู ุงูุฑุณุงุฆู ุจุญุฑูุฉ
   - ูููู ุญุฐู ุงููุญุงุฏุซุฉ ูู ุงููุงุฆูุฉ

4. **ุฅุฐุง ุฑููุถ:**
   - ุงููุญุงุฏุซุฉ ุชุตุจุญ "ูุฑููุถ"
   - ูุง ูููู ุฅุฑุณุงู ุฑุณุงุฆู ุฃุฎุฑู ููุฐุง ุงูุฏูุชูุฑ

### ููุฏูุชูุฑ:

1. **ุงุณุชูุจุงู ุงูุทูุจุงุช:**
   - ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ุชุธูุฑ ูู ููุญุฉ ุงููุญุงุฏุซุงุช
   - ุญุงูุฉ "ููุฏ ุงูุงูุชุธุงุฑ" ูุน ุนุฏุงุฏ ุงูุฑุณุงุฆู ุบูุฑ ุงูููุฑูุกุฉ

2. **ูุจูู ุงูุทูุจ:**
   - ุงูุฏูุชูุฑ ูุถุบุท "ูุจูู"
   - ุงููุญุงุฏุซุฉ ุชุตุจุญ ูุดุทุฉ
   - ูููู ุงูุฑุฏ ูุงูุชูุงุตู ุจุญุฑูุฉ

3. **ุฑูุถ ุงูุทูุจ:**
   - ุงูุฏูุชูุฑ ูุถุบุท "ุฑูุถ"
   - ุงููุญุงุฏุซุฉ ุชุฎุชูู ูู ูุงุฆูุชู
   - ุงููุฑูุถ ูุง ูุณุชุทูุน ุฅุฑุณุงู ุฑุณุงุฆู ุฃุฎุฑู

4. **ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช:**
   - ูููู ุญุฐู ุงููุญุงุฏุซุงุช ุงูููุจููุฉ
   - ุงููุญุงุฏุซุงุช ุงููุฑููุถุฉ ุชุฎุชูู ุชููุงุฆูุงู

## ููุงุนุฏ ุงูุจูุงูุงุช (Firestore Structure)

### Collection: `chats`
```javascript
{
  doctorId: "doctor_uid",
  patientId: "patient_uid",
  doctorName: "ุฏ. ุฃุญูุฏ ูุญูุฏ",
  patientName: "ูุญูุฏ ุนูู",
  status: "pending", // pending | accepted | rejected
  initialMessage: "ูุฑุญุจุงู ุฏูุชูุฑุ ุฃุฑูุฏ ุงุณุชุดุงุฑุฉ...",
  lastMessage: "ุดูุฑุงู ูู",
  lastMessageTime: Timestamp,
  unreadCount: {
    doctor: 2,
    patient: 0
  },
  deletedBy: {
    doctor: false,
    patient: false
  },
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### Subcollection: `chats/{chatId}/messages`
```javascript
{
  senderId: "user_uid",
  senderRole: "patient", // doctor | patient
  senderName: "ูุญูุฏ ุนูู",
  text: "ูุฑุญุจุงู ุฏูุชูุฑ",
  createdAt: Timestamp,
  read: false
}
```

## ููุงุนุฏ ุงูุฃูุงู (Firestore Rules)

```javascript
// Chat rules
match /chats/{chatId} {
  allow read: if request.auth != null && 
    (resource.data.doctorId == request.auth.uid || 
     resource.data.patientId == request.auth.uid);
  
  allow create: if request.auth != null && 
    request.resource.data.patientId == request.auth.uid;
  
  allow update: if request.auth != null && 
    (resource.data.doctorId == request.auth.uid || 
     resource.data.patientId == request.auth.uid);
  
  // Messages subcollection
  match /messages/{messageId} {
    allow read: if request.auth != null && 
      (get(/databases/$(database)/documents/chats/$(chatId)).data.doctorId == request.auth.uid || 
       get(/databases/$(database)/documents/chats/$(chatId)).data.patientId == request.auth.uid);
    
    allow create: if request.auth != null && 
      request.resource.data.senderId == request.auth.uid;
    
    allow update: if request.auth != null;
  }
}
```

## ุงูุชุตููู (UI/UX)

### ุงูุฃููุงู:
- **Primary**: Blue (#3B82F6)
- **Background**: White (#FFFFFF)
- **Secondary Background**: Gray-50 (#F9FAFB)
- **Text**: Gray-900 (#111827)
- **Muted Text**: Gray-500 (#6B7280)
- **Border**: Gray-200 (#E5E7EB)

### ุงูููุงุนุงุช (Bubbles):
- **ุฑุณุงุฆู ุงููุณุชุฎุฏู**: ุฃุฒุฑู (#3B82F6) - ูุญุงุฐุงุฉ ูููู
- **ุฑุณุงุฆู ุงูุทุฑู ุงูุขุฎุฑ**: ุฃุจูุถ ูุน ุญุฏูุฏ - ูุญุงุฐุงุฉ ูุณุงุฑ
- **Border Radius**: 16px (ูุณุชุฏูุฑ)
- **Shadow**: ุฎููู ุฌุฏุงู

### ุงูุฃููููุงุช:
- โ - ุฑุณุงูุฉ ูุฑุณูุฉ
- โโ - ุฑุณุงูุฉ ููุฑูุกุฉ
- ๐ - ููุฏ ุงูุงูุชุธุงุฑ
- โ - ููุจูู
- โ - ูุฑููุถ

## ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ:

1. **ุฅุฑุณุงู ุฑุณุงูุฉ ุฃูููุฉ:**
   - ูุฑูุถ ูุฑุณู ุฑุณุงูุฉ ูุฏูุชูุฑ
   - ุงูุชุญูู ูู ุธููุฑูุง ูู ููุญุฉ ุงูุฏูุชูุฑ
   - ุงูุชุญูู ูู ุญุงูุฉ "ููุฏ ุงูุงูุชุธุงุฑ"

2. **ูุจูู ุงูุทูุจ:**
   - ุฏูุชูุฑ ููุจู ุงูุทูุจ
   - ุงูุชุญูู ูู ุชุบููุฑ ุงูุญุงูุฉ ุฅูู "ููุจูู"
   - ุงูุชุญูู ูู ุฅููุงููุฉ ุชุจุงุฏู ุงูุฑุณุงุฆู

3. **ุฑูุถ ุงูุทูุจ:**
   - ุฏูุชูุฑ ูุฑูุถ ุงูุทูุจ
   - ุงูุชุญูู ูู ุงุฎุชูุงุก ุงููุญุงุฏุซุฉ ูู ููุญุฉ ุงูุฏูุชูุฑ
   - ุงูุชุญูู ูู ุนุฏู ุฅููุงููุฉ ุงููุฑูุถ ุฅุฑุณุงู ุฑุณุงุฆู ุฃุฎุฑู

4. **ุญุฐู ุงููุญุงุฏุซุฉ:**
   - ูุณุชุฎุฏู ูุญุฐู ูุญุงุฏุซุฉ
   - ุงูุชุญูู ูู ุงุฎุชูุงุฆูุง ูู ูุงุฆูุชู ููุท
   - ุงูุชุญูู ูู ุจูุงุก ุงูุฑุณุงุฆู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

5. **ูุคุดุฑุงุช ุงููุฑุงุกุฉ:**
   - ุฅุฑุณุงู ุฑุณุงูุฉ
   - ุงูุชุญูู ูู ุนูุงูุฉ ูุงุญุฏุฉ (โ)
   - ูุชุญ ุงููุญุงุฏุซุฉ ูู ุงูุทุฑู ุงูุขุฎุฑ
   - ุงูุชุญูู ูู ุนูุงูุชูู (โโ)

## ุงูููุงุญุธุงุช ุงููููุฉ

1. **ุงูุฃูุงู:**
   - ุฌููุน ุงูุนูููุงุช ูุญููุฉ ุจููุงุนุฏ Firestore
   - ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ุนูู ูุณุชูู ุงูุฎุงุฏู

2. **ุงูุฃุฏุงุก:**
   - ุงุณุชุฎุฏุงู Real-time listeners ููุชุญุฏูุซุงุช ุงูููุฑูุฉ
   - Pagination ูููุญุงุฏุซุงุช (ุฅุฐุง ูุงู ุงูุนุฏุฏ ูุจูุฑ)

3. **ุงูุชุฌุฑุจุฉ:**
   - ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
   - ุชุฃููุฏุงุช ูุจู ุงูุญุฐู
   - ูุคุดุฑุงุช ุชุญููู ุฃุซูุงุก ุงูุนูููุงุช

4. **ุงูุตูุงูุฉ:**
   - ุงูุฑุณุงุฆู ูุง ุชูุญุฐู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ูููู ุฅุถุงูุฉ ููุฒุฉ ุงูุฃุฑุดูุฉ ูุงุญูุงู
   - ูููู ุฅุถุงูุฉ ุชูุงุฑูุฑ ูููุญุงุฏุซุงุช

## ุงูุชุทููุฑ ุงููุณุชูุจูู

### ููุฒุงุช ููุชุฑุญุฉ:
- [ ] ุฅุดุนุงุฑุงุช push ููุฑุณุงุฆู ุงูุฌุฏูุฏุฉ
- [ ] ุงูุจุญุซ ูู ุงููุญุงุฏุซุงุช
- [ ] ุฃุฑุดูุฉ ุงููุญุงุฏุซุงุช
- [ ] ุชูุงุฑูุฑ ุงููุญุงุฏุซุงุช ููุฃุฏูู
- [ ] ุชุฑุฌูุฉ ุชููุงุฆูุฉ ููุฑุณุงุฆู
- [ ] ููุงูุจ ุฑุณุงุฆู ุฌุงูุฒุฉ ููุฏูุชูุฑ
- [ ] ุฌุฏููุฉ ุงูุฑุณุงุฆู
- [ ] ุฑุณุงุฆู ุตูุชูุฉ (ุงุฎุชูุงุฑู)

## ุงูุชุงุฑูุฎ
ุชู ุงูุชุทููุฑ: 14 ูุจุฑุงูุฑ 2026
ุงูุฅุตุฏุงุฑ: 2.0
