# إصلاح خطأ الصلاحيات في صفحة طلبات الأطباء

## المشكلة
```
Error fetching doctor requests: FirebaseError: Missing or insufficient permissions.
```

## السبب
صفحة طلبات الأطباء تتطلب صلاحيات مسؤول (Admin) للوصول إليها، ولكن:
- إما أنك غير مسجل دخول
- أو أنك مسجل دخول كمستخدم عادي وليس كمسؤول

## الحل

### الخطوة 1: إنشاء حساب المسؤول
قم بتشغيل أحد الأوامر التالية:

**Windows:**
```bash
create-admin.bat
```

**أو مباشرة:**
```bash
npx tsx scripts/makeAdmin.ts
```

**Linux/Mac:**
```bash
npm run make-admin
```

### الخطوة 2: بيانات تسجيل الدخول
بعد إنشاء الحساب، استخدم هذه البيانات:
- البريد الإلكتروني: `admin@doctor.com`
- كلمة المرور: `Admin@123456`

### الخطوة 3: تسجيل الدخول
1. افتح صفحة تسجيل دخول المسؤول: `/admin-login`
2. أدخل البيانات أعلاه
3. سجل الدخول

### الخطوة 4: الوصول لصفحة الطلبات
الآن يمكنك الوصول لصفحة طلبات الأطباء بدون مشاكل!

## ملاحظات مهمة

### قواعد Firestore
القواعد الحالية تسمح فقط للمسؤولين بقراءة طلبات الأطباء:

```javascript
match /doctorRequests/{requestId} {
  allow read: if isAdmin();
  allow create: if true; // أي شخص يمكنه إرسال طلب
  allow update: if isAdmin();
  allow delete: if isAdmin();
}
```

### التحقق من دور المستخدم
يتم التحقق من دور المسؤول عبر:
1. التأكد من تسجيل الدخول
2. قراءة مستند المستخدم من `users/{uid}`
3. التحقق من أن `role == 'admin'`

## استكشاف الأخطاء

### إذا استمرت المشكلة:

1. **تأكد من نشر قواعد Firestore:**
```bash
firebase deploy --only firestore:rules
```

2. **تحقق من وجود مستند المستخدم:**
   - افتح Firebase Console
   - اذهب إلى Firestore Database
   - تحقق من وجود مستند في `users/{uid}` مع `role: 'admin'`

3. **امسح الكاش وأعد تسجيل الدخول:**
   - سجل الخروج
   - امسح كاش المتصفح
   - سجل الدخول مرة أخرى

4. **تحقق من Console:**
   - افتح Developer Tools (F12)
   - تحقق من رسائل الخطأ في Console
   - تحقق من Network tab لرؤية طلبات Firestore

## التحديثات المطبقة

تم تحديث الكود لعرض رسائل خطأ أوضح:
- ✅ رسالة خطأ واضحة عند عدم وجود صلاحيات
- ✅ زر للعودة لوحة التحكم
- ✅ معالجة أفضل للأخطاء في `doctorRequestService.ts`
